<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>AozoraEditor</title>
    <base href="/" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />

    <!-- If you add any scoped CSS files, uncomment the following to load them
    <link href="AozoraEditor.styles.css" rel="stylesheet" /> -->
</head>

<body>
    <div id="app">Loading...</div>

    <script src="./lib/monaco-editor/min/vs/loader.js"></script>

    <script>
        require.config({ paths: { vs: "./lib/monaco-editor/min/vs" } });

        const snippets = [
            { key: 'kaicho', text: 'æ”¹ä¸' },
            { key: 'kaipage', text: 'æ”¹ãƒšãƒ¼ã‚¸' },
            { key: 'kaimihiraki', text: 'æ”¹è¦‹é–‹ã' },
            { key: 'kaidan', text: 'æ”¹æ®µ' },

            { key: 'jisa', text: '${1:number}å­—ä¸‹ã’' },
            { key: 'jisastart', text: ['ã“ã“ã‹ã‚‰${1:number}å­—ä¸‹ã’', 'ã“ã“ã§å­—ä¸‹ã’çµ‚ã‚ã‚Š'].join('\n') },
            { key: 'jisaorikaeshi', text: ['ã“ã“ã‹ã‚‰${1:number}å­—ä¸‹ã’ã€æŠ˜ã‚Šè¿”ã—ã¦${2:number}å­—ä¸‹ã’', 'ã“ã“ã§å­—ä¸‹ã’çµ‚ã‚ã‚Š'].join('\n') },
            { key: 'tenorikaeshi', text: 'ã“ã“ã‹ã‚‰æ”¹è¡Œå¤©ä»˜ãã€æŠ˜ã‚Šè¿”ã—ã¦[ï¼-ï¼™]+å­—ä¸‹ã’' },

        ];

        //ã‚¨ãƒ‡ã‚£ã‚¿ã¯é…åˆ—ã§ç›£ç†ã—ã¦ã€è¦ç´ ã®ç•ªå·ã‚’IDã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚
        var editors = [];

        function GetMonacoText(editor_id) {
            if (editor_id < 0 || editor_id >= editors.length) return "";
            return editors[editor_id].getValue();
        }

        function ApplyMonacoEditorAozora(container_id, initial_text) {//id:string
            const editor_id = editors.length;
            require(["vs/editor/editor.main"], function () {
                monaco.languages.register({ id: 'aozora' });
                /*
                 * keywordã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã®ã§æ­£è¦è¡¨ç¾ã¯ä½¿ãˆãªã„ã€‚
                 * ['æ”¹ä¸', 'æ”¹ãƒšãƒ¼ã‚¸', 'æ”¹è¦‹é–‹ã', 'æ”¹æ®µ', '[ï¼-ï¼™]+å­—ä¸‹ã’',
                 * 'ã“ã“ã§å­—ä¸‹ã’çµ‚ã‚ã‚Š', 'ã“ã“ã‹ã‚‰[ï¼-ï¼™]+å­—ä¸‹ã’', 'ã“ã“ã‹ã‚‰[ï¼-ï¼™]+å­—ä¸‹ã’ã€æŠ˜ã‚Šè¿”ã—ã¦[ï¼-ï¼™]+å­—ä¸‹ã’',
                 * 'ã“ã“ã‹ã‚‰æ”¹è¡Œå¤©ä»˜ãã€æŠ˜ã‚Šè¿”ã—ã¦[ï¼-ï¼™]+å­—ä¸‹ã’', '[ï¼-ï¼™]+å­—ä¸‹ã’', 'åœ°ä»˜ã', 'ã“ã“ã‹ã‚‰åœ°ä»˜ã', 'ã“ã“ã§åœ°ä»˜ãçµ‚ã‚ã‚Š',
                 * 'åœ°ã‹ã‚‰[ï¼-ï¼™]+å­—ä¸Šã’', 'ã“ã“ã‹ã‚‰åœ°ã‹ã‚‰[ï¼-ï¼™]+å­—ä¸Šã’', 'ã“ã“ã§å­—ä¸Šã’çµ‚ã‚ã‚Š',
                 * 'ãƒšãƒ¼ã‚¸ã®å·¦å³ä¸­å¤®',
                 * 'ã€Œ.+?ã€ã¯[å°ä¸­å¤§]è¦‹å‡ºã—', 'å°è¦‹å‡ºã—ã‚ˆã‚Šã‚‚ã•ã‚‰ã«ä¸‹ä½ã®è¦‹å‡ºã—ã«ã¯ã€æ³¨è¨˜ã—ã¾ã›ã‚“ã§ã—ãŸã€‚'?,
                 * '[å°ä¸­å¤§]è¦‹å‡ºã—', '[å°ä¸­å¤§]è¦‹å‡ºã—çµ‚ã‚ã‚Š',
                 * 'ã“ã“ã‹ã‚‰[å°ä¸­å¤§]è¦‹å‡ºã—', 'ã“ã“ã§[å°ä¸­å¤§]è¦‹å‡ºã—çµ‚ã‚ã‚Š',
                 * 'ã€Œ.+?ã€ã¯åŒè¡Œ[å°ä¸­å¤§]è¦‹å‡ºã—',
                 * 'åŒè¡Œ[å°ä¸­å¤§]è¦‹å‡ºã—', 'åŒè¡Œ[å°ä¸­å¤§]è¦‹å‡ºã—çµ‚ã‚ã‚Š',
                 * 'ã€Œ.+?ã€ã¯çª“[å°ä¸­å¤§]è¦‹å‡ºã—',
                 * 'çª“[å°ä¸­å¤§]è¦‹å‡ºã—', 'çª“[å°ä¸­å¤§]è¦‹å‡ºã—çµ‚ã‚ã‚Š',
                 * * å¤–å­—ã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‘ãã§ã¯ãªã„
                 * * è¨“ç‚¹ã‚‚ã‚„ã‚„ã“ã—ã„ã®ã§çœç•¥
                 * 'ã€Œ.+ã€ã«.+', ä¸‹ã¯è‰²ã‚“ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
                 * 'å‚ç‚¹', 'ç™½ã‚´ãƒå‚ç‚¹', 'ä¸¸å‚ç‚¹', 'ç™½ä¸¸å‚ç‚¹', 'é»’ä¸‰è§’å‚ç‚¹', 'ç™½ä¸‰è§’å‚ç‚¹', 'äºŒé‡ä¸¸å‚ç‚¹', 'è›‡ã®ç›®å‚ç‚¹', 'ã°ã¤å‚ç‚¹', 'å‚ç·š', 'äºŒé‡å‚ç·š', 'é–ç·š', 'ç ´ç·š', 'æ³¢ç·š', 'ä¸‹ä»˜ãå°æ–‡å­—', 'ä¸Šä»˜ãå°æ–‡å­—', 'è¡Œå³å°æ›¸ã', 'è¡Œå·¦å°æ›¸ã',
                 * 'ã€Œ.+?ã€ã¯(å¤ªå­—|æ–œä½“)', '(å¤ªå­—|æ–œä½“)', '(å¤ªå­—|æ–œä½“)çµ‚ã‚ã‚Š', 'ã“ã“ã‹ã‚‰(å¤ªå­—|æ–œä½“)', 'ã“ã“ã§(å¤ªå­—|æ–œä½“)çµ‚ã‚ã‚Š',
                 * '.+?ï¼ˆ.+?ã€æ¨ª[0-9]+Ã—ç¸¦[0-9]+ï¼‰å…¥ã‚‹', 'ã€Œ.+ã€.+?ï¼ˆ.+?ã€æ¨ª[0-9]+Ã—ç¸¦[0-9]+ï¼‰å…¥ã‚‹', '.+?ï¼ˆ.+?ï¼‰å…¥ã‚‹'(obsolete),
                 * 'ã€Œ.+?ã€ã¯ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³', 'ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³', 'ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³çµ‚ã‚ã‚Š',
                 * 'ã€Œ.+?ã€ã«ã€Œ.+?ã€ã®æ³¨è¨˜', 'ã€Œ.+?ã€ã¯åº•æœ¬ã§ã¯ã€Œ.+?ã€', 'ã€Œ.+?ã€ã¯ãƒãƒ',
                 * 'ã€Œ.+?ã€ã®å·¦ã«ã€Œ.+?ã€ã®ãƒ«ãƒ“', 'å·¦ã«ãƒ«ãƒ“ä»˜ã', 'å·¦ã«ã€Œ.+?ã€ã®ãƒ«ãƒ“ä»˜ãçµ‚ã‚ã‚Š', 'ã€Œ.+?ã€ã®å·¦ã«ã€Œ.+?ã€ã®æ³¨è¨˜',
                 * 'æ³¨è¨˜ä»˜ã', 'ã€Œ.+?ã€ã®æ³¨è¨˜ä»˜ãçµ‚ã‚ã‚Š',
                 * 'å·¦ã«æ³¨è¨˜ä»˜ã', 'å·¦ã«ã€Œ.+?ã€ã®æ³¨è¨˜ä»˜ãçµ‚ã‚ã‚Š',
                 * 'åº•æœ¬ï¼š'(ã‚³ãƒãƒ³ãƒ‰å¤–), 'æœ¬æ–‡çµ‚ã‚ã‚Š',
                 * 'ã€Œ.+?ã€ã¯ç¸¦ä¸­æ¨ª', 'ç¸¦ä¸­æ¨ª', 'ç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Š', 'å‰²ã‚Šæ³¨', 'å‰²ã‚Šæ³¨çµ‚ã‚ã‚Š', 'æ”¹è¡Œ',
                 * 'ã€Œ.+ã€ã¯è¡Œ[å³å·¦]å°æ›¸ã', 'è¡Œ[å³å·¦]å°æ›¸ã', 'è¡Œ[å³å·¦]å°æ›¸ãçµ‚ã‚ã‚Š',
                 * 'ã€Œ.+?ã€ã¯[ä¸Šä¸‹]ä»˜ãå°æ–‡å­—', '[ä¸Šä¸‹]ä»˜ãå°æ–‡å­—', '[ä¸Šä¸‹]ä»˜ãå°æ–‡å­—çµ‚ã‚ã‚Š',
                 * 'ã“ã“ã‹ã‚‰[ï¼-ï¼™]+å­—è©°ã‚', 'ã“ã“ã§å­—è©°ã‚çµ‚ã‚ã‚Š',
                 * 'ã“ã“ã‹ã‚‰ç½«å›²ã¿', 'ã“ã“ã§ç½«å›²ã¿çµ‚ã‚ã‚Š', 'ã€Œ.+?ã€ã¯ç½«å›²ã¿', 'ç½«å›²ã¿', 'ç½«å›²ã¿çµ‚ã‚ã‚Š',
                 * 'ã“ã“ã‹ã‚‰æ¨ªçµ„ã¿', 'ã“ã“ã§æ¨ªçµ„ã¿çµ‚ã‚ã‚Š', 'ã€Œ.+?ã€ã¯æ¨ªçµ„ã¿', 'æ¨ªçµ„ã¿', 'æ¨ªçµ„ã¿çµ‚ã‚ã‚Š',
                 * 'ã€Œ.+ã€ã¯[ï¼-ï¼™]+æ®µéšå¤§ããªæ–‡å­—', '[ï¼-ï¼™]+æ®µéšå¤§ããªæ–‡å­—', 'å¤§ããªæ–‡å­—çµ‚ã‚ã‚Š', '[ï¼-ï¼™]+æ®µéšå°ã•ãªæ–‡å­—', 'å°ã•ãªæ–‡å­—çµ‚ã‚ã‚Š',
                 * 'ã“ã“ã‹ã‚‰[ï¼-ï¼™]+æ®µéšå¤§ããªæ–‡å­—', 'ã“ã“ã§å¤§ããªæ–‡å­—çµ‚ã‚ã‚Š', 'ã“ã“ã‹ã‚‰[ï¼-ï¼™]+æ®µéšå°ã•ãªæ–‡å­—', 'ã“ã“ã§å°ã•ãªæ–‡å­—çµ‚ã‚ã‚Š',
                 * ];
                 */
                const keywords = [];//ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯åŸºæœ¬ï¼»ï¼ƒ.+?ï¼½ã®ä¸­ãªã®ã§ã€åˆ¥ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ã™ã‚‹å¿…è¦ã¯ãªã„ã¨åˆ¤æ–­
                monaco.languages.setMonarchTokensProvider('aozora', {
                    defaultToken: 'invalid',
                    keywords,
                    tokenizer: {
                        root: [
                            [/ã€Š.*?ã€‹/, 'ruby'],
                            [/â€»?ï¼»ï¼ƒ.+?ï¼½/, 'command'],
                            [/ã€”.+?ã€•/, 'accent'],
                            [/^åº•æœ¬ï¼š.+$/, 'sokohon'],
                        ],
                    }
                });

                monaco.editor.defineTheme('aozoraThemeLight', {
                    base: 'vs',
                    inherit: false,
                    rules: [
                        { token: 'ruby', foreground: '808080' },
                        { token: 'command', foreground: '00A000', fontStyle: 'bold' },
                        { token: 'accent', foreground: '0000A0' },
                        { token: 'sokohon', foreground: '008000', },
                    ],
                    colors: {
                        'editor.foreground': '#000000'
                    }
                });

                monaco.editor.defineTheme('aozoraThemeDark', {
                    base: 'vs',
                    inherit: false,
                    rules: [
                        { token: 'ruby', foreground: '808080' },
                        { token: 'command', foreground: '006000', fontStyle: 'bold' },
                        { token: 'accent', foreground: '000060' },
                        { token: 'sokohon', foreground: '008800', },
                    ],
                    colors: {
                        'editor.foreground': '#000000'
                    }
                });

                monaco.languages.registerCompletionItemProvider('aozora', {
                    provideCompletionItems: (model, position, context, token) => {
                        //ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½ã¯è¡Œé ­ã‹ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¥åŠ›å¾Œã—ã‹æ©Ÿèƒ½ã—ãªã„ã€‚å¾“ã£ã¦ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã€‚åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ä»¥å¤–ãªã‚‰å‰Šé™¤ä¸è¦ã€‚
                        let snipetDeleteSpace = [];
                        if (position.column > 2) { // columnã¯ãªãœã‹1ã‹ã‚‰å§‹ã¾ã‚‹ã€‚ã¾ãŸæ–‡å­—å…¥åŠ›å¾Œãªã®ã§ã€2ãªã‚‰è¡Œé ­ã€‚
                            let rangeEdit = { startLineNumber: position.lineNumber, endLineNumber: position.lineNumber, startColumn: position.column - 2, endColumn: position.column - 1 };
                            let charEdit = model.getValueInRange(rangeEdit);
                            if (charEdit == ' ') { snipetDeleteSpace = [{ text: '', range: rangeEdit }]; }
                        }
                        var suggestions = [
                            {
                                label: 'ruby',
                                kind: monaco.languages.CompletionItemKind.Snippet,
                                insertText: 'ã€Š${1:ruby}ã€‹',
                                insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                                additionalTextEdits: snipetDeleteSpace,
                            },
                        ];
                        return { suggestions: suggestions };
                    }
                });

                const editor = monaco.editor.create(
                    document.getElementById(container_id),
                    {
                        value: initial_text,
                        language: "aozora",
                        theme: 'aozoraThemeLight',

                        unicodeHighlight: {
                            ambiguousCharacters: false,
                        },

                        folding: true,
                        wordWrap: true,
                        automaticLayout: true,

                        suggest: {
                            snippetsPreventQuickSuggestions: false
                        }

                        // Disable suggestion:
                        //https://github.com/microsoft/monaco-editor/issues/1681
                        //suggest: {
                        //    showFields: false,
                        //    showFunctions: false,
                        //},
                        //quickSuggestions: {
                        //    "other": false,
                        //    "comments": false,
                        //    "strings": false
                        //},
                        //parameterHints: {
                        //    enabled: false
                        //},
                        //suggestOnTriggerCharacters: false,
                        //acceptSuggestionOnEnter: "off",
                        //tabCompletion: "off",
                        //wordBasedSuggestions: false,
                    }
                );
                editors[editor_id] = editor;
            });
            return editor_id;
        }
    </script>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ğŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
</body>

</html>
