@page "/editor";
@inject IJSRuntime JSRuntime;

<div id="container"
	 style="width: 800px; height: 600px; border: 1px solid grey;"></div>

<button @onclick="Test">Check on console</button>

@code {
	int monaco_id = -1;

	private async void Test()
	{
		var text = await GetText();

		var jstream = new Aozora.JstreamString(text, false);
		var output = new Aozora.Helpers.OutputString();
		//var output = new Aozora.Helpers.OutputConsole();
		var aozora = new Aozora.Aozora2Html(jstream, output, new Aozora.Helpers.OutputConsole(), "./gaiji/", null)
			{
				UseJisx0213Accent = true,
				UseJisx0214EmbedGaiji = true,
				UseUnicodeEmbedGaiji = true,
			};
		aozora.Process();
		Console.WriteLine(output.ToString());
	}

	private async Task<string> GetText()
	{
		if (monaco_id < 0) return string.Empty;
		return await JSRuntime.InvokeAsync<string>("GetMonacoText", monaco_id);
	}

	private async Task InitEditor()
	{
		monaco_id = await JSRuntime.InvokeAsync<int>("ApplyMonacoEditorAozora", "container", "吾輩は猫である\n夏目漱石\n\nここに本文を入力。\n");
	}


	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();
		await InitEditor();
	}
}
