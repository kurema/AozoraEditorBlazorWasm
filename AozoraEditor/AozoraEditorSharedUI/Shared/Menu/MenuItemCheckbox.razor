@implements IMenuItemSingleBasic
@inject IJSRuntime JSRuntime;

@code {
	[CascadingParameter(Name = nameof(Parent))]
	public IMenuParent? Parent { get; set; }

	[CascadingParameter(Name = nameof(ParentProvider))]
	public IMenuParent? ParentProvider { get; set; }

	public void Hide() { }

	public bool IsChildrenVisible => false;
	public bool HasChild => false;
	[Parameter]
	public bool IsChecked { get; set; }

	public async Task InvokeAsync()
	{

		IMenuParent? parent = Parent;
		while ((parent as IMenuItemSingle)?.Parent is { } p) parent = p;
		parent?.Hide();
		await OnHeaderSelected.InvokeAsync(null);

		if (!IsChecked) await Checked.InvokeAsync(); else await UnChecked.InvokeAsync();
		if (Parent is MenuItem pmi) pmi.NotifyStateHasChanged();
	}
	[Parameter]
	public string Title { get; set; } = String.Empty;
	[Parameter]
	public EventCallback Checked{ get; set; }
	[Parameter]
	public EventCallback UnChecked{ get; set; }
	public ElementReference? ElementHeader { get; set; }
	public Task ShowAsync(double posX = -1, double posY = -1) => Task.CompletedTask;
	[Parameter]
	public EventCallback OnHeaderSelected { get; set; }
	public RenderFragment? Icon => @<span class="material-symbols-outlined">@(IsChecked ? "check" : string.Empty)</span>;

	[Parameter]
	public Func<bool>? IsVisible { get; set; }

	protected override void OnInitialized()
	{
		if (ParentProvider is not null) ParentProvider.AddItem(this);
		else if (Parent is not null) Parent.AddItem(this);
		else throw new ArgumentNullException(nameof(Parent), "MenuItem requires the parent.");
		base.OnInitialized();
	}
}
